<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Vibe Coding Slides - æµ‹è¯•è¿è¡Œå™¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Inter", "PingFang SC", sans-serif;
      background: #1D1D1F;
      color: #FFFFFF;
      min-height: 100vh;
      padding: 40px;
    }
    
    .test-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .test-header h1 {
      font-size: 32px;
      margin-bottom: 10px;
    }
    
    .test-header p {
      color: #86868B;
      font-size: 16px;
    }
    
    .test-controls {
      display: flex;
      gap: 20px;
      justify-content: center;
      margin-bottom: 40px;
    }
    
    .btn {
      padding: 12px 32px;
      font-size: 16px;
      font-weight: 600;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
    }
    
    .btn-primary {
      background: #0071E3;
      color: white;
    }
    
    .btn-primary:hover {
      background: #0077ED;
      transform: translateY(-2px);
    }
    
    .btn-secondary {
      background: #2D2D2F;
      color: white;
    }
    
    .btn-secondary:hover {
      background: #3D3D3F;
    }
    
    .test-output {
      background: #2D2D2F;
      border-radius: 16px;
      padding: 30px;
      max-width: 900px;
      margin: 0 auto;
      font-family: "SF Mono", "JetBrains Mono", monospace;
      font-size: 14px;
      line-height: 1.8;
      white-space: pre-wrap;
      min-height: 400px;
    }
    
    .test-summary {
      display: flex;
      gap: 30px;
      justify-content: center;
      margin-top: 30px;
    }
    
    .summary-card {
      background: #2D2D2F;
      padding: 20px 40px;
      border-radius: 12px;
      text-align: center;
    }
    
    .summary-card .number {
      font-size: 48px;
      font-weight: 700;
    }
    
    .summary-card .label {
      color: #86868B;
      font-size: 14px;
      margin-top: 5px;
    }
    
    .passed .number { color: #34C759; }
    .failed .number { color: #FF3B30; }
    .total .number { color: #0071E3; }
    
    /* æµ‹è¯•ç”¨çš„éšè— iframe */
    #test-frame {
      position: fixed;
      top: -10000px;
      left: -10000px;
      width: 1920px;
      height: 1080px;
      border: none;
    }
    
    .status-badge {
      display: inline-block;
      padding: 6px 16px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
      margin-left: 10px;
    }
    
    .status-pending {
      background: #86868B;
    }
    
    .status-running {
      background: #FF9500;
    }
    
    .status-passed {
      background: #34C759;
    }
    
    .status-failed {
      background: #FF3B30;
    }
  </style>
</head>
<body>
  <div class="test-header">
    <h1>ğŸ§ª Vibe Coding Slides æµ‹è¯•è¿è¡Œå™¨</h1>
    <p>TDD å¼€å‘èŒƒå¼ - å…ˆæµ‹è¯•åå®ç°</p>
    <span class="status-badge status-pending" id="status-badge">å¾…è¿è¡Œ</span>
  </div>
  
  <div class="test-controls">
    <button class="btn btn-primary" onclick="runAllTests()">â–¶ï¸ è¿è¡Œå…¨éƒ¨æµ‹è¯•</button>
    <button class="btn btn-secondary" onclick="clearOutput()">ğŸ—‘ï¸ æ¸…ç©ºè¾“å‡º</button>
    <a href="../index.html" class="btn btn-secondary">ğŸ“º æŸ¥çœ‹ Slides</a>
  </div>
  
  <div class="test-output" id="test-output">ç­‰å¾…è¿è¡Œæµ‹è¯•...</div>
  
  <div class="test-summary" id="test-summary" style="display: none;">
    <div class="summary-card passed">
      <div class="number" id="passed-count">0</div>
      <div class="label">é€šè¿‡</div>
    </div>
    <div class="summary-card failed">
      <div class="number" id="failed-count">0</div>
      <div class="label">å¤±è´¥</div>
    </div>
    <div class="summary-card total">
      <div class="number" id="total-count">0</div>
      <div class="label">æ€»è®¡</div>
    </div>
  </div>
  
  <!-- éšè—çš„ iframe ç”¨äºåŠ è½½ä¸»é¡µé¢è¿›è¡Œæµ‹è¯• -->
  <iframe id="test-frame" src="../index.html"></iframe>
  
  <script src="slides.test.js"></script>
  <script>
    const output = document.getElementById('test-output');
    const statusBadge = document.getElementById('status-badge');
    let testFrame = null;
    
    // é‡å®šå‘ console.log åˆ°è¾“å‡ºåŒºåŸŸ
    const originalLog = console.log;
    console.log = function(...args) {
      originalLog.apply(console, args);
      output.textContent += args.join(' ') + '\n';
      output.scrollTop = output.scrollHeight;
    };
    
    function clearOutput() {
      output.textContent = '';
      document.getElementById('test-summary').style.display = 'none';
      statusBadge.textContent = 'å¾…è¿è¡Œ';
      statusBadge.className = 'status-badge status-pending';
    }
    
    async function runAllTests() {
      clearOutput();
      statusBadge.textContent = 'è¿è¡Œä¸­...';
      statusBadge.className = 'status-badge status-running';
      
      // ç­‰å¾… iframe åŠ è½½å®Œæˆ
      testFrame = document.getElementById('test-frame');
      
      try {
        // ç­‰å¾…ä¸»é¡µé¢åŠ è½½
        await new Promise((resolve) => {
          if (testFrame.contentWindow.SlidesApp) {
            resolve();
          } else {
            testFrame.onload = resolve;
          }
        });
        
        // å°†å…¨å±€å¯¹è±¡æŒ‡å‘ iframe ä¸­çš„å†…å®¹
        window.SlidesApp = testFrame.contentWindow.SlidesApp;
        
        // é‡æ–°è®¾ç½® document æŸ¥è¯¢ä»¥æŒ‡å‘ iframe
        const originalQuerySelector = document.querySelector.bind(document);
        const originalQuerySelectorAll = document.querySelectorAll.bind(document);
        
        document.querySelector = (selector) => {
          return testFrame.contentDocument.querySelector(selector);
        };
        
        document.querySelectorAll = (selector) => {
          return testFrame.contentDocument.querySelectorAll(selector);
        };
        
        // è¿è¡Œæµ‹è¯•
        const success = await TestRunner.run();
        
        // æ¢å¤åŸå§‹ document æ–¹æ³•
        document.querySelector = originalQuerySelector;
        document.querySelectorAll = originalQuerySelectorAll;
        
        // æ›´æ–°ç»Ÿè®¡
        document.getElementById('passed-count').textContent = TestRunner.passed;
        document.getElementById('failed-count').textContent = TestRunner.failed;
        document.getElementById('total-count').textContent = TestRunner.passed + TestRunner.failed;
        document.getElementById('test-summary').style.display = 'flex';
        
        if (success) {
          statusBadge.textContent = 'å…¨éƒ¨é€šè¿‡ âœ“';
          statusBadge.className = 'status-badge status-passed';
        } else {
          statusBadge.textContent = 'å­˜åœ¨å¤±è´¥ âœ—';
          statusBadge.className = 'status-badge status-failed';
        }
        
      } catch (error) {
        console.log(`\nâŒ æµ‹è¯•è¿è¡Œé”™è¯¯: ${error.message}`);
        console.log('è¯·ç¡®ä¿ index.html å·²æ­£ç¡®å®ç°æ‰€æœ‰åŠŸèƒ½');
        statusBadge.textContent = 'è¿è¡Œé”™è¯¯';
        statusBadge.className = 'status-badge status-failed';
      }
    }
    
    // é¡µé¢åŠ è½½åè‡ªåŠ¨æ£€æŸ¥ iframe çŠ¶æ€
    document.getElementById('test-frame').onload = () => {
      console.log('ğŸ“„ ä¸»é¡µé¢å·²åŠ è½½ï¼Œå‡†å¤‡è¿è¡Œæµ‹è¯•\n');
    };
  </script>
</body>
</html>
